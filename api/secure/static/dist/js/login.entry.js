this.login=this.login||{},this.login.entry=this.login.entry||{},function(){"use strict";function t(){m.loginButton.on("click",n),m.registerButton.on("click",e);var t=m.id.validator();t.on("invalid.bs.validator",y.onValidate),t.on("valid.bs.validator",y.onValidate)}function n(t){m.id.validator("validate"),y.isFormValid()&&i()}function e(){window.location.replace("/v1/register")}function i(){y.submitDisabled(!0),$.ajax({url:"/v1/login",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({Identifier:m.identity.val(),Password:m.password.val(),IP:k,Location:h,ReturnURL:w}),cache:!1,success:function(t){localStorage.setItem("avotoken",t),s(t),m.id.trigger("reset")},error:function(t){console.error(t),$("#success").html("<div class='alert alert-danger'>"),$("#success > .alert-danger").html("<button type='button' class='close' data-dismiss='alert' aria-hidden='true'>&times;").append("</button>"),$("#success > .alert-danger").append($("<strong>").text("Sorry, it seems something went wrong. Please try again.")),$("#success > .alert-danger").append("</div>"),m.id.trigger("reset")},complete:function(){setTimeout(function(){y.submitDisabled(!1)},1e3)}})}function o(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(a)}function a(t){h=t.coords.latitude+", "+t.coords.longitude}function r(){$.getJSON("//jsonip.com/?callback=?",function(t){k=t.ip})}function s(t){var n=w||"http://www.localhost/";n+="?avotoken="+t,window.location.replace(n)}var l=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},c=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),u={},d={},f=function(t){u[t]={valid:!0,errors:[]}},g=function(t,n){u[t]={valid:!1,errors:n},v(!0)},v=function(t){d.prop("disabled",t)},p=function(){for(var t=!0,n=Object.keys(u),e=n.length,i=0;i<e;i++){var o=n[i];if(!u[o].valid){t=!1;break}}return t},b=function(){function t(n){l(this,t),d=n}return c(t,[{key:"onValidate",value:function(t){var n="valid"===t.type,e=t.relatedTarget.id;if(n)f(e);else{var i=t.detail;g(e,i)}p()&&v(!1)}},{key:"isFormValid",value:function(){return p()}},{key:"submitDisabled",value:function(t){v(t)}}]),t}(),m={id:$("#frmLogin"),identity:$("#txtIdentity"),password:$("#txtPassword"),loginButton:$("#btnLogin"),registerButton:$("#btnRegister")},y={},w="",h="",k="";$(document).ready(function(){(y=new b(m.loginButton)).submitDisabled(!0);var n=localStorage.getItem("avotoken");w=document.referrer,n?s(n):(t(),o(),r())})}();
